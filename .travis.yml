language: node_js
os: linux
node_js:
  - "9"

script: echo "Running jobs install then tests against $(node -v) ..."

jobs:
  include:
    - stage: npm install
      script:
        - echo "Installing needed modules"
        - npm install
    - stage: npm build
      script:
        - echo "Running build script ..."
        - npm run-script build
    - stage: npm test
      script:
        - echo "Testing branch - $(branch) ..."
        - npm test
    - stage: npm release
      if: branch = master AND commit_message =~ /^[0-9]*\.[0-9]*\.[0-9]*$/
        - echo "Test passed, will run deploy job"
    after_success:
      if: branch not in (master, develop)
      - "curl -o /tmp/travis-automerge https://raw.githubusercontent.com/cdown/travis-automerge/master/travis-automerge"
      - "chmod a+x /tmp/travis-automerge"
      - "BRANCHES_TO_MERGE_REGEX='^f/' BRANCH_TO_MERGE_INTO=master GITHUB_REPO=olayenca/react-logic-switch /tmp/travis-automerge"

